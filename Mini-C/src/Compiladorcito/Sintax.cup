package Compiladorcito;

import java_cup.runtime.*;
import java.util.ArrayList;
import java.util.*;
import java.io.*;

parser code {:
    ArrayList gramas = new ArrayList();
    public Nodo raiz;
    public int cont = 0;
    public int maximo(){
    int a=5;
    return a;
}
    ArrayList errores=new ArrayList();
    public Symbol s;
    @Override
    public void syntax_error (Symbol s){
        if(s.left==-1){
        }else{
                errores.add("Syntax error en la línea: " + (s.left) + " , columna: " +(s.right)+ " con el símbolo = "+(s.value));
    }
}
    @Override
    public void unrecovered_syntax_error(Symbol s){
    if(s.left==-1){
    }else{
        errores.add("Error desconocido, por favor revise la linea: " + (s.left ) + " y columna:  " + (s.right )+ "Con simbolo: "+s.value);
    }    
    }
    public Symbol getS(){
        return this.s;
    }
:} ;



terminal tkn_opadicion,tkn_opmulti, tkn_break, tkn_opmod ;
terminal tkn_oprel ,tkn_main, tkn_intp, tkn_charp, tkn_void;
terminal tkn_if ,tkn_while, tkn_else,tkn_parentesisiz ,tkn_parentesisde ,tkn_llaveiz ,tkn_llaveder ; 
terminal tkn_and,tkn_or,tkn_for,tkn_return, tkn_printf, tkn_scanf, tkn_increment, tkn_decrement;
terminal tkn_dospuntos,tkn_int ,tkn_char, tkn_id, tkn_puntocoma, tkn_ternario, tkn_num, tkn_coma;
terminal tkn_ampersand, tkn_cadena, tkn_caracter;


non terminal Nodo WHILE, IF, FOR,CONDICION, ELSE, CONDICIONP, TIPO, 
    IDINT, TERNARIO, CONTADOR, SCANF, FUNCION, FUNCIONPARAMS, DECLAPARAM, PROTOTIPO, PROTOPARAMS, 
    RETURN, PARAMS, LLAMADO, ARGSPARAMS, ARGS, EXPRTERNARIO, EXPRFIN, EXPR, ASIGN, ITERADOR, ASIGNACION, DECLASIGN;
non terminal Nodo INICIO,MAIN,BLOQUE,FUNCIONES,PRINTF,DECLARACION, PROGRAM,PROTOTIPOS,LISTADO_FUNCIONES, DECLR, PROTOFUN;
precedence left tkn_opadicion;
precedence left tkn_opmulti, tkn_opmod;

start with INICIO;

INICIO::= PROGRAM
;

PROGRAM::= PROTOTIPO PROGRAM
          | FUNCION PROGRAM
          | ASIGN PROGRAM
;

PROTOTIPO::= PROTOFUN tkn_puntocoma | PROTOFUN error {:parser.errores.add("Error en fin de linea se espera un ';' \n");:}
;

FUNCION::= PROTOFUN tkn_llaveiz BLOQUE tkn_return EXPR tkn_puntocoma tkn_llaveder 
           | tkn_int tkn_main tkn_parentesisiz tkn_parentesisde tkn_llaveiz BLOQUE tkn_return EXPR tkn_puntocoma tkn_llaveder
           | PROTOFUN tkn_llaveiz BLOQUE tkn_return EXPR tkn_puntocoma error  {:parser.errores.add("Llave de cierre '}' ausente en la funcion\n");:}
           | PROTOFUN tkn_llaveiz BLOQUE tkn_return EXPR error tkn_llaveiz  {:parser.errores.add("Se esperaba un ';' en linea de retorno de la funcion\n");:}
          
;

PROTOFUN::= DECLR tkn_parentesisiz PARAMS tkn_parentesisde
;

DECLR::= TIPO tkn_id
;

ASIGNACION::= TIPO tkn_id tkn_oprel | tkn_id tkn_oprel
;

DECLASIGN::= DECLR tkn_oprel EXPR tkn_coma DECLASIGN 
            | DECLR tkn_oprel EXPR
            | DECLR tkn_coma DECLASIGN 
            | tkn_id tkn_coma DECLASIGN
            | tkn_id error DECLASIGN error {:parser.errores.add("Se esperaba el simbolo ',' en declaración \n");:}
            | tkn_id tkn_oprel EXPR tkn_coma DECLASIGN 
            | tkn_id tkn_oprel EXPR
            | DECLR 
            | DECLR tkn_oprel tkn_id tkn_parentesisiz ARGS tkn_parentesisde 
            | tkn_id tkn_oprel tkn_id tkn_parentesisiz ARGS tkn_parentesisde
;


ASIGN::= DECLASIGN tkn_puntocoma |  error tkn_puntocoma {:parser.errores.add("Error en declaracion \n");:}
;

PARAMS::= TIPO tkn_coma PARAMS
         | DECLR tkn_coma PARAMS
         | DECLR
         | TIPO
         | 
;

IF::= tkn_if tkn_parentesisiz CONDICION tkn_parentesisde tkn_llaveiz BLOQUE tkn_llaveder ELSE 
     | tkn_if tkn_parentesisiz CONDICION tkn_parentesisde error BLOQUE tkn_llaveder ELSE {:parser.errores.add("Llave de apertura '{' ausente en bloque if\n");:}
     | tkn_if error CONDICION tkn_parentesisde tkn_llaveiz BLOQUE tkn_llaveder ELSE {:parser.errores.add("Se esperaba el simbolo '(' en bloque if\n");:}
     | tkn_if tkn_parentesisiz CONDICION error tkn_llaveiz BLOQUE tkn_llaveder ELSE {:parser.errores.add("Se esperaba el simbolo ')' en bloque if\n");:}
;

ELSE ::= tkn_else tkn_llaveiz BLOQUE tkn_llaveder
        | tkn_else IF
        |
;

FOR ::= tkn_for tkn_parentesisiz ASIGNACION EXPR tkn_puntocoma CONDICION tkn_puntocoma tkn_id ITERADOR tkn_parentesisde tkn_llaveiz BLOQUE:j tkn_llaveder
        | tkn_for error ASIGNACION EXPR tkn_puntocoma CONDICION tkn_puntocoma tkn_id ITERADOR tkn_parentesisde tkn_llaveiz BLOQUE:j tkn_llaveder {:parser.errores.add("Se esperaba un parentesis de apertura '(' for\n");:}
        | tkn_for tkn_parentesisiz ASIGNACION EXPR tkn_puntocoma CONDICION tkn_puntocoma tkn_id ITERADOR error tkn_llaveiz BLOQUE:j tkn_llaveder {:parser.errores.add("Se esperaba un parentesis de cierre ')' for\n");:}
;

WHILE ::= tkn_while tkn_parentesisiz CONDICION tkn_parentesisde tkn_llaveiz BLOQUE:j tkn_llaveder
        | tkn_while tkn_parentesisiz CONDICION tkn_parentesisde error BLOQUE:j tkn_llaveder  {:parser.errores.add("Se esperaba un '{' en bloque while\n");:}
        | tkn_while tkn_parentesisiz CONDICION error tkn_llaveiz BLOQUE:j tkn_llaveder  {:parser.errores.add("Se esperaba un ')' en bloque while\n");:}
;

PRINTF ::= tkn_printf tkn_parentesisiz tkn_cadena tkn_coma tkn_id tkn_parentesisde tkn_puntocoma
        |  tkn_printf tkn_parentesisiz tkn_cadena tkn_parentesisde tkn_puntocoma
        |  tkn_printf tkn_parentesisiz tkn_cadena error tkn_id tkn_parentesisde tkn_puntocoma {:parser.errores.add("coma ',' ausente en la funcion printf");:}
        |  tkn_printf tkn_parentesisiz tkn_cadena tkn_coma error tkn_parentesisde tkn_puntocoma {:parser.errores.add("identificador ausente en la funcion printf");:}
        |  tkn_printf tkn_parentesisiz tkn_cadena tkn_coma tkn_id error tkn_puntocoma {:parser.errores.add("parentesis de cierre ')' ausente en la funcion printf");:}
        |  tkn_printf tkn_parentesisiz tkn_cadena tkn_coma tkn_id tkn_parentesisde error {:parser.errores.add("se esperaba el simbolo ';' en la funcion printf");:}
        |  tkn_printf error tkn_cadena tkn_coma tkn_id tkn_parentesisde tkn_puntocoma {:parser.errores.add("se esperaba el simbolo '(' en la funcion printf");:}
        |  tkn_printf tkn_parentesisiz error tkn_coma tkn_id tkn_parentesisde tkn_puntocoma {:parser.errores.add("conststr ausente en la funcion printf");:}

;

SCANF::= tkn_scanf tkn_parentesisiz tkn_cadena tkn_coma tkn_ampersand tkn_id tkn_parentesisde tkn_puntocoma
         | tkn_scanf tkn_parentesisiz tkn_cadena tkn_coma error tkn_id tkn_parentesisde tkn_puntocoma {:parser.errores.add("Puntero a identificador '&' ausente en la funcion scanf");:}
         | tkn_scanf tkn_parentesisiz tkn_cadena tkn_coma tkn_ampersand error tkn_parentesisde tkn_puntocoma {:parser.errores.add("identificador ausente en la funcion scanf");:}
         | tkn_scanf tkn_parentesisiz tkn_cadena tkn_coma tkn_ampersand tkn_id error tkn_puntocoma {:parser.errores.add("parentesis de cierre ')' ausente en la funcion scanf");:}
         | tkn_scanf error tkn_cadena tkn_coma tkn_ampersand tkn_id tkn_parentesisde tkn_puntocoma {:parser.errores.add("parentesis de apertura '(' ausente en la funcion scanf");:}
         | tkn_scanf tkn_parentesisiz error tkn_coma tkn_ampersand tkn_id tkn_parentesisde tkn_puntocoma {:parser.errores.add("conststr ausente en la funcion scanf");:}

;

BLOQUE ::=  IF BLOQUE
            | FOR BLOQUE
            | WHILE BLOQUE
            | ASIGN BLOQUE
            | SCANF BLOQUE
            | PRINTF BLOQUE
            | CONTADOR BLOQUE
            |
;


ITERADOR::= tkn_increment
            |tkn_decrement
            | tkn_opadicion tkn_oprel EXPR
            | tkn_opmulti tkn_oprel EXPR

;

CONDICION ::= CONDICIONP tkn_and CONDICION
            | CONDICIONP tkn_or CONDICION
            | tkn_parentesisiz CONDICIONP tkn_parentesisde tkn_and CONDICION 
            | tkn_parentesisiz CONDICIONP tkn_parentesisde tkn_or CONDICION 
            | tkn_parentesisiz CONDICIONP tkn_parentesisde
            | CONDICIONP
;

CONDICIONP::= EXPR tkn_oprel EXPR
;

TIPO::= tkn_char
        |tkn_intp
        |tkn_charp
        |tkn_int
        |tkn_void
;

EXPR ::= EXPR tkn_opadicion EXPR 
        | EXPR tkn_opmulti EXPR 
        | EXPR tkn_opmod EXPR 
        | tkn_parentesisiz EXPR tkn_parentesisde
        | tkn_id 
        | tkn_num
        | tkn_caracter 

;
ARGS::= ARGSPARAMS
        |
;

ARGSPARAMS ::= tkn_id tkn_coma ARGSPARAMS| tkn_id
;

CONTADOR ::= tkn_id ITERADOR tkn_puntocoma
;


